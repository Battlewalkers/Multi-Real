<!DOCTYPE html>
<html>
  <head>
    <title>My First Render Site</title>
  </head>
  <body>

    <h1>Hello! Your site is working.</h1>
    <p>This is the simplest possible setup.</p>

    <!-- Test Supabase button -->
    <button id="testButton">Send Test to Supabase</button>

    <!-- Age Check -->
    <h2>Age Check</h2>
    <label>
      <input type="checkbox" id="ageCheck">
      Are you 13+?
    </label>

    <!-- Signup for 13+ (email required) -->
    <div id="signupEmailSection" style="display:none;">
      <h2>Create Account (13+)</h2>
      <input id="signupEmail" type="email" placeholder="Email">
      <input id="signupPassword" type="password" placeholder="Password">
      <button id="signupButton">Sign Up</button>
    </div>

    <!-- Signup for under 13 (username only) -->
    <div id="signupUsernameSection" style="display:none;">
      <h2>Create Account (Under 13)</h2>
      <input id="signupUsername" type="text" placeholder="Username">
      <input id="signupUserPassword" type="password" placeholder="Password">
      <button id="signupUserButton">Sign Up Without Email</button>
    </div>

    <!-- Login (email only for 13+) -->
    <h2>Login</h2>
    <input id="loginEmail" type="email" placeholder="Email">
    <input id="loginPassword" type="password" placeholder="Password">
    <button id="loginButton">Log In</button>

    <!-- Status message -->
    <h2>Status</h2>
    <p id="status"></p>

    <!-- Public environment variables -->
    <script>
      window.env = {
        NEXT_PUBLIC_SUPABASE_URL: "https://ytgwxpxjivruoewxbuyr.supabase.co",
        NEXT_PUBLIC_SUPABASE_ANON_KEY: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inl0Z3d4cHhqaXZydW9ld3hidXlyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ0ODMxODcsImV4cCI6MjA4MDA1OTE4N30.YMWdo_dRFKt5uufujOZ9BKe-Ygdc0fau1qVnltfmP6o"
      };
    </script>

    <!-- Supabase logic -->
    <script type="module">
      import { createClient } from "https://esm.sh/@supabase/supabase-js@2";

      const supabase = createClient(
        window.env.NEXT_PUBLIC_SUPABASE_URL,
        window.env.NEXT_PUBLIC_SUPABASE_ANON_KEY
      );

      // Test button
      document.getElementById("testButton").onclick = async () => {
        const { data, error } = await supabase
          .from("test_messages")
          .insert([{ message: "Hello from my website!" }]);

        if (error) {
          alert("Error: " + error.message);
        } else {
          alert("Success! Message sent to Supabase.");
        }
      };

      // Age check logic
      const ageCheck = document.getElementById("ageCheck");
      const signupEmailSection = document.getElementById("signupEmailSection");
      const signupUsernameSection = document.getElementById("signupUsernameSection");

      ageCheck.onchange = () => {
        if (ageCheck.checked) {
          signupEmailSection.style.display = "block";
          signupUsernameSection.style.display = "none";
        } else {
          signupEmailSection.style.display = "none";
          signupUsernameSection.style.display = "block";
        }
      };

      // Signup (13+)
      document.getElementById("signupButton").onclick = async () => {
        const email = document.getElementById("signupEmail").value;
        const password = document.getElementById("signupPassword").value;

        const { error } = await supabase.auth.signUp({
          email: email,
          password: password
        });

        document.getElementById("status").innerText =
          error ? "Signup error: " + error.message : "Signup successful! Check your email.";
      };

      // Signup (under 13)
      document.getElementById("signupUserButton").onclick = async () => {
        const username = document.getElementById("signupUsername").value;
        const password = document.getElementById("signupUserPassword").value;

        const { error } = await supabase
          .from("child_users")
          .insert([{ username, password }]);

        document.getElementById("status").innerText =
          error ? "Signup error: " + error.message : "Under-13 account created!";
      };

      // Login (13+ only)
      document.getElementById("loginButton").onclick = async () => {
        const email = document.getElementById("loginEmail").value;
        const password = document.getElementById("loginPassword").value;

        const { error } = await supabase.auth.signInWithPassword({
          email: email,
          password: password
        });

        document.getElementById("status").innerText =
          error ? "Login error: " + error.message : "Login successful!";
      };
    </script>

  </body>
</html>
